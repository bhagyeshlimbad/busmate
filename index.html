<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>BusMate</title>
  <!-- Bootstrap CSS -->
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
  <script src="https://cdn.jsdelivr.net/npm/xlsx@0.18.5/dist/xlsx.full.min.js"></script>
  <style>
    body { background: #f5f5f5; }
    header { background: #007bff; color: white; padding: 10px; text-align: center; font-size: 20px; font-weight: bold; }
    .hidden { display: none; }
    .card-btn { font-size: 18px; padding: 20px; }
  </style>
</head>
<body>

  <!-- Login Page -->
  <div id="loginPage" class="container mt-5">
    <div class="card p-4 shadow">
      <h3 class="text-center">BusMate Login</h3>
      <input type="text" id="username" class="form-control mt-3" placeholder="Username">
      <input type="password" id="password" class="form-control mt-3" placeholder="Password">
      <button class="btn btn-primary w-100 mt-3" onclick="login()">Login</button>
    </div>
  </div>

  <!-- Home Page -->
  <div id="homePage" class="hidden">
    <header>BusMate - <span id="roleHeader"></span></header>
    <div class="container mt-4">
      <p>Welcome, <b><span id="userName"></span></b></p>
      <div class="row g-3">
        <div class="col-6"><button class="btn btn-outline-primary w-100 card-btn" onclick="showPage('tripPage')">üöç Start Trip</button></div>
        <div class="col-6"><button class="btn btn-outline-primary w-100 card-btn" onclick="showPage('locationPage')">üìç Locations</button></div>
        <div class="col-6"><button class="btn btn-outline-primary w-100 card-btn" onclick="showPage('setupPage')">üõ† Trip Setup</button></div>
        <div class="col-6"><button class="btn btn-outline-primary w-100 card-btn" onclick="showPage('companyPage')">üè¢ Company Info</button></div>
        <div class="col-6"><button class="btn btn-outline-primary w-100 card-btn" onclick="showPage('reportPage')">üìä Reports</button></div>
        <div class="col-6 adminOnly"><button class="btn btn-danger w-100 card-btn" onclick="showPage('adminPage')">‚öô Admin Panel</button></div>
      </div>
    </div>
  </div>

  <!-- Company Info Page -->
  <div id="companyPage" class="hidden container mt-4">
    <h4>Company Information</h4>
    <input id="companyName" class="form-control mt-2" placeholder="Company Name">
    <input id="companyLogo" class="form-control mt-2" placeholder="Company Logo URL">
    <button class="btn btn-success mt-2" onclick="saveCompany()">Save</button>
    <h5 class="mt-4">Users</h5>
    <ul id="userList" class="list-group"></ul>
    <button class="btn btn-primary mt-2" onclick="addUser()">Add User</button>
    <button class="btn btn-secondary mt-3" onclick="goHome()">‚¨Ö Back</button>
  </div>

  <!-- Locations Page -->
  <div id="locationPage" class="hidden container mt-4">
    <h4>Locations</h4>
    <div class="input-group mt-2">
      <input id="locName" class="form-control" placeholder="Location Name">
      <input id="locLat" class="form-control" placeholder="Latitude">
      <input id="locLng" class="form-control" placeholder="Longitude">
      <input id="locRadius" class="form-control" placeholder="Radius (m)">
    </div>
    <input id="locMsg" class="form-control mt-2" placeholder="Announcement Message">
    <button class="btn btn-success mt-2" onclick="addLocation()">Add Location</button>
    <ul id="locationList" class="list-group mt-3"></ul>
    <button class="btn btn-secondary mt-3" onclick="goHome()">‚¨Ö Back</button>
  </div>

  <!-- Trip Setup Page -->
  <div id="setupPage" class="hidden container mt-4">
    <h4>Trip Setup</h4>
    <input id="tripName" class="form-control mt-2" placeholder="Trip Name">
    <select id="tripLocations" class="form-select mt-2" multiple></select>
    <button class="btn btn-success mt-2" onclick="addTrip()">Save Trip</button>
    <ul id="tripList" class="list-group mt-3"></ul>
    <button class="btn btn-secondary mt-3" onclick="goHome()">‚¨Ö Back</button>
  </div>

  <!-- Trip Page -->
  <div id="tripPage" class="hidden container mt-4">
    <h4>Start Trip</h4>
    <ul id="activeTrips" class="list-group"></ul>
    <button class="btn btn-secondary mt-3" onclick="goHome()">‚¨Ö Back</button>
  </div>

  <!-- Report Page -->
  <div id="reportPage" class="hidden container mt-4">
    <h4>Reports</h4>
    <button class="btn btn-primary mt-2" onclick="exportReport()">‚¨á Export to Excel</button>
    <ul id="reportList" class="list-group mt-3"></ul>
    <button class="btn btn-secondary mt-3" onclick="goHome()">‚¨Ö Back</button>
  </div>

  <!-- Admin Page -->
  <div id="adminPage" class="hidden container mt-4">
    <h4>Admin Panel</h4>
    <ul id="adminReport" class="list-group"></ul>
    <button class="btn btn-secondary mt-3" onclick="goHome()">‚¨Ö Back</button>
  </div>

  <script>
    let users = [];
    let locations = [];
    let trips = [];
    let reports = [];

    function login() {
      const user = document.getElementById("username").value || "Operator";
      const role = (user.toLowerCase() === "admin") ? "Admin" : "User";
      document.getElementById("userName").innerText = user;
      document.getElementById("roleHeader").innerText = role;
      document.getElementById("loginPage").classList.add("hidden");
      document.getElementById("homePage").classList.remove("hidden");
      if(role === "Admin") {
        document.querySelectorAll(".adminOnly").forEach(el => el.style.display="block");
      } else {
        document.querySelectorAll(".adminOnly").forEach(el => el.style.display="none");
      }
      // track login
      reports.push({user, role, device:navigator.userAgent, time:new Date().toLocaleString()});
    }

    function showPage(id) {
      document.querySelectorAll("body > div").forEach(div => div.classList.add("hidden"));
      document.getElementById(id).classList.remove("hidden");
    }

    function goHome() {
      showPage("homePage");
    }

    // Company info
    function saveCompany() {
      alert("Company info saved!");
    }
    function addUser() {
      const uname = prompt("Enter new user name:");
      if(uname) {
        users.push(uname);
        renderUsers();
      }
    }
    function renderUsers() {
      document.getElementById("userList").innerHTML = users.map(u=>`<li class="list-group-item">${u}</li>`).join("");
    }

    // Locations
    function addLocation() {
      const loc = {
        name:document.getElementById("locName").value,
        lat:document.getElementById("locLat").value,
        lng:document.getElementById("locLng").value,
        radius:document.getElementById("locRadius").value,
        msg:document.getElementById("locMsg").value
      };
      locations.push(loc);
      renderLocations();
      renderTripLocations();
    }
    function renderLocations() {
      document.getElementById("locationList").innerHTML = locations.map(l=>`<li class="list-group-item">${l.name} - ${l.msg}</li>`).join("");
    }

    // Trip setup
    function renderTripLocations() {
      document.getElementById("tripLocations").innerHTML = locations.map((l,i)=>`<option value="${i}">${l.name}</option>`).join("");
    }
    function addTrip() {
      const tname = document.getElementById("tripName").value;
      const selected = Array.from(document.getElementById("tripLocations").selectedOptions).map(o=>locations[o.value].name);
      trips.push({name:tname, locs:selected});
      renderTrips();
    }
    function renderTrips() {
      document.getElementById("tripList").innerHTML = trips.map(t=>`<li class="list-group-item">${t.name} (${t.locs.join(", ")})</li>`).join("");
      document.getElementById("activeTrips").innerHTML = trips.map(t=>`<li class="list-group-item">${t.name} - <button onclick="startTrip('${t.name}')">Start</button></li>`).join("");
    }

    // Start trip
    function startTrip(name) {
      alert("Trip started: " + name);
    }

    // Reports
    function exportReport() {
      const ws = XLSX.utils.json_to_sheet(reports);
      const wb = XLSX.utils.book_new();
      XLSX.utils.book_append_sheet(wb, ws, "Reports");
      XLSX.writeFile(wb, "reports.xlsx");
    }
  </script>

</body>
</html>
